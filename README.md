# Go-Broker: ูุฑููุฑฺฉ ูพุงูโุฑุณุงู ุจุง Redis

Go-Broker ฺฉ ูุฑููุฑฺฉ ฺฉูฺฺฉุ ูุฏุฑุชููุฏ ู ุณุทุญ ุจุงูุง ุจุฑุง ูุฏุฑุช ูพุฑุฏุงุฒุดโูุง ูพุณโุฒููู ู ุงุฑุชุจุงุทุงุช ุฑูุฏุงุฏูุญูุฑ ุฏุฑ ุจุฑูุงููโูุง Go ุจุง ุงุณุชูุงุฏู ุงุฒ Redis (ูุณุฎู 9) ุงุณุช. ุงู ูุฑููุฑฺฉ ุจุง ุงููุงู ุงุฒ ุณุงุฏฺฏ Ginุ ูพฺุฏฺฏโูุง ฺฉุงุฑ ุจุง Redis Streams ู Pub/Sub ุฑุง ูพููุงู ฺฉุฑุฏู ู ฺฉ ุฑุงุจุท ุชูุฒ ู ุณุงุฏู ุจุฑุง ุชูุณุนูโุฏููุฏฺฏุงู ูุฑุงูู ูโฺฉูุฏ.

---

## ๐ ูฺฺฏโูุง ฺฉูุฏ

* **ูพุดุชุจุงู ุงุฒ ุณู ุงูฺฏู ูพุงูโุฑุณุงู:**
    1.  **ฺฉุงุฑูุง ุญุงุช (Tasks):** ุจุง ุงุณุชูุงุฏู ุงุฒ `Redis Streams` ุจุฑุง ุชุถูู ูพุฑุฏุงุฒุด ูุงุจู ุงุนุชูุงุฏ ู ูุงูุฏฺฏุงุฑ.
    2.  **ุฑูุฏุงุฏูุง ุขู (Events):** ุจุง ุงุณุชูุงุฏู ุงุฒ `Redis Pub/Sub` ุจุฑุง ุงุทูุงุนโุฑุณุงูโูุง ุฒูุฏู ู ุบุฑูุงูุฏฺฏุงุฑ.
    3.  **ุฏุฑุฎูุงุณุช/ูพุงุณุฎ (RPC):** ุงูฺฏู ุจุฑุง ุงุฑุณุงู ฺฉ ฺฉุงุฑ ู ุงูุชุธุงุฑ ุจุฑุง ุฏุฑุงูุช ูพุงุณุฎ ุจุง ูุงุจูุช ุชุนู Timeout.
* **ูุฏุฑุช ุฎูุฏฺฉุงุฑ Goroutine:** ุจุฑุง ูุฑ ฺฉุงุฑ ุง ุฑูุฏุงุฏ ุฏุฑุงูุชุ ฺฉ Goroutine ุฌุฏุฏ ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุงุฌุงุฏ ู ูุฏุฑุช ูโุดูุฏ.
* **ฺฉูุชุฑู ููุฒูุงู:** ูุงุจูุช ุชุนู ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ ฺฉุงุฑูุง ููุฒูุงู ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูุดุงุฑ ุจุด ุงุฒ ุญุฏ ุจู ููุงุจุน ุณุณุชู.
* **ุฎุงููุด ุดุฏู ุงูู (Graceful Shutdown):** ุจุง ุฏุฑุงูุช ุณฺฏูุงู ุฎุฑูุฌุ ุจุฑูุงูู ููุชุธุฑ ูโูุงูุฏ ุชุง ฺฉุงุฑูุง ุฏุฑ ุญุงู ูพุฑุฏุงุฒุด ุจู ุงุชูุงู ุจุฑุณูุฏ.
* **ุฑุงุจุท ฺฉุงุฑุจุฑ ุณุงุฏู ู ุณุทุญ ุจุงูุง (High-level API):** ูุชุฏูุง ุณุงุฏู ูุงููุฏ `Enqueue`, `Publish`, `Request` ุจุฑุง ุงุฑุณุงู ู `OnTask`, `OnEvent`, `OnRequest` ุจุฑุง ุซุจุช ูพุฑุฏุงุฒุดฺฏุฑูุง.

---
## โ๏ธ ูพุงุฑุงูุชุฑูุง ุงุตู

ููฺฏุงู ุณุงุฎุช ฺฉ ููููู ุฌุฏุฏ ุงุฒ ุงูพูฺฉุดูุ ุดูุง ฺูุฏ ูพุงุฑุงูุชุฑ ฺฉูุฏ ุฑุง ูุดุฎุต ูโฺฉูุฏ:
`broker.New(client, streamName, groupName, maxJobs)`

* `streamName`: ูุงู ุตู ุงุตู ุดูุง ุจุฑุง ฺฉุงุฑูุง ุญุงุช ู ูุงูุฏฺฏุงุฑ (Tasks ู RPC).
* `groupName`: **ฺฉ ูุงู ุถุฑูุฑ ุจุฑุง ฺฏุฑูู ูุตุฑูโฺฉููุฏฺฏุงู (Consumer Group)**. ุงู ูุงู ุจู ฺูุฏู ููููู ุงุฒ ุจุฑูุงูู ุดูุง (ูุซูุงู ุงฺฏุฑ ุจุฑูุงูู ุฑุง ุฑู ฺูุฏ ุณุฑูุฑ ุงุฌุฑุง ฺฉูุฏ) ุงุฌุงุฒู ูโุฏูุฏ ุชุง ุจู ุตูุฑุช ููุงููฺฏ ุงุฒ ฺฉ ุตู ูุดุชุฑฺฉ (`streamName`) ฺฉุงุฑูุง ุฑุง ุจุฑุฏุงุฑูุฏ ุจุฏูู ุงูฺฉู ฺฉ ฺฉุงุฑ ุฑุง ุฏู ุจุงุฑ ูพุฑุฏุงุฒุด ฺฉููุฏ. ุงู ฺฉูุฏ ุงุตู ุจุฑุง **ููุงุณโูพุฐุฑ (Scalability)** ู **ูพุงุฏุงุฑ (Fault Tolerance)** ุณุณุชู ุดูุงุณุช.
* `maxJobs`: ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ ฺฉุงุฑูุง ฺฉู ุจู ุตูุฑุช ููุฒูุงู ุงุฒ ุตู Stream ูพุฑุฏุงุฒุด ูโุดููุฏ.

---

## โก ูุญูู ุงุณุชูุงุฏู

### ฑ. ุฑุงูโุงูุฏุงุฒ ูุฑฺฉุฑ (`examples/worker/main.go`)

ุจุฑูุงูู ุงุตู ุดูุง ููุท ูุธูู ุฑุงูโุงูุฏุงุฒ ู ุงุฌุฑุง ูุฑฺฉุฑ ุฑุง ุจุฑ ุนูุฏู ุฏุงุฑุฏ.

```go
package main

import (
    "context"
    "go-broker-example/broker"
    "go-broker-example/examples/handlers"
    "[github.com/redis/go-redis/v9](https://github.com/redis/go-redis/v9)"
)

func main() {
    // ... ุณุงุฎุช context ู ุงุชุตุงู ุจู Redis ...
    appInstance := broker.New(rdb, "task_queue", "main_group", 10)

    // ุซุจุช ูพุฑุฏุงุฒุดฺฏุฑูุง
    appInstance.OnTask("NEW_ORDER", handlers.ProcessNewOrder)
    appInstance.OnEvent("user_events", handlers.LogUserLogin)
    appInstance.OnRequest("GET_USER_INFO", handlers.GetUserInfo)

    // ุงุฌุฑุง ูุฑููุฑฺฉ
    appInstance.Run(ctx)
}
```

### ฒ. ุงุฑุณุงู ูพุงู ุงุฒ ฺฉูุงูุช (`examples/client/main.go`)

ุฏุฑ ูุฑ ุจุฎุด ุฏฺฏุฑ ุงุฒ ุจุฑูุงูู ุฎูุฏ ูโุชูุงูุฏ ุจุง ุณุงุฎุช ฺฉ ููููู ุงุฒ `broker.App`ุ ุจู ุฑุงุญุช ูพุงู ุงุฑุณุงู ฺฉูุฏ.

```go
package main

import (
    "context"
    "go-broker-example/broker"
    "[github.com/redis/go-redis/v9](https://github.com/redis/go-redis/v9)"
)

func main() {
    // ... ุงุชุตุงู ุจู Redis ...
    clientApp := broker.New(rdb, "task_queue", "main_group", 0)

    // ุงุฑุณุงู ฺฉ ฺฉุงุฑ ุญุงุช
    clientApp.Enqueue(ctx, "NEW_ORDER", map[string]string{"id": "ORD-12345"})

    // ุงุฑุณุงู ฺฉ ุฑูุฏุงุฏ ุขู
    clientApp.Publish(ctx, "user_events", map[string]string{"username": "Alice"})

    // ุงุฑุณุงู ฺฉ ุฏุฑุฎูุงุณุช RPC
    resp, err := clientApp.Request(ctx, "GET_USER_INFO", map[string]int{"id": 99}, 5*time.Second)
}
```